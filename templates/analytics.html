{% extends "base.html" %}

{% block title %}Analytics - Sales Forecasting{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-4 text-center mb-4">
            <i class="fas fa-chart-bar text-primary"></i> Sales Analytics
        </h1>
        <p class="text-center text-muted">Interactive visualizations and data exploration</p>
    </div>
</div>

<!-- Charts Grid -->
<div class="row g-4">
    <!-- Sales Trend Chart -->
    <div class="col-lg-12">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Sales Trend Over Time</h5>
            </div>
            <div class="card-body">
                <div id="salesTrendChart"></div>
            </div>
        </div>
    </div>
    
    <!-- Monthly Sales Chart -->
    <div class="col-lg-6">
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-calendar me-2"></i>Average Sales by Month</h5>
            </div>
            <div class="card-body">
                <div id="monthlySalesChart"></div>
            </div>
        </div>
    </div>
    
    <!-- Store Performance Chart -->
    <div class="col-lg-6">
        <div class="card shadow-sm">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-store me-2"></i>Top 10 Stores by Revenue</h5>
            </div>
            <div class="card-body">
                <div id="storePerformanceChart"></div>
            </div>
        </div>
    </div>
    
    <!-- Seasonal Analysis Chart -->
    <div class="col-lg-6">
        <div class="card shadow-sm">
            <div class="card-header bg-warning text-white">
                <h5 class="mb-0"><i class="fas fa-leaf me-2"></i>Sales Distribution by Season</h5>
            </div>
            <div class="card-body">
                <div id="seasonalChart"></div>
            </div>
        </div>
    </div>
    
    <!-- Promotion Impact Chart -->
    <div class="col-lg-6">
        <div class="card shadow-sm">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="fas fa-percentage me-2"></i>Impact of Promotions</h5>
            </div>
            <div class="card-body">
                <div id="promotionChart"></div>
            </div>
        </div>
    </div>
    
    <!-- Weekend Analysis Chart -->
    <div class="col-lg-12">
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fas fa-calendar-week me-2"></i>Weekend vs Weekday Performance</h5>
            </div>
            <div class="card-body">
                <div id="weekendChart"></div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Spinner -->
<div id="loadingSpinner" class="text-center my-5" style="display: none;">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading analytics data...</p>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Show loading spinner
    document.getElementById('loadingSpinner').style.display = 'block';
    
    // Fetch and display all charts
    Promise.all([
        fetch('/api/sales_trend').then(response => response.json()),
        fetch('/api/monthly_sales').then(response => response.json()),
        fetch('/api/store_performance').then(response => response.json()),
        fetch('/api/seasonal_analysis').then(response => response.json()),
        fetch('/api/promotion_impact').then(response => response.json()),
        fetch('/api/weekend_analysis').then(response => response.json())
    ]).then(([salesTrend, monthlySales, storePerf, seasonal, promotion, weekend]) => {
        // Hide loading spinner
        document.getElementById('loadingSpinner').style.display = 'none';
        
        // Render charts
        Plotly.newPlot('salesTrendChart', salesTrend.data, salesTrend.layout, {responsive: true});
        Plotly.newPlot('monthlySalesChart', monthlySales.data, monthlySales.layout, {responsive: true});
        Plotly.newPlot('storePerformanceChart', storePerf.data, storePerf.layout, {responsive: true});
        Plotly.newPlot('seasonalChart', seasonal.data, seasonal.layout, {responsive: true});
        Plotly.newPlot('promotionChart', promotion.data, promotion.layout, {responsive: true});
        Plotly.newPlot('weekendChart', weekend.data, weekend.layout, {responsive: true});
    }).catch(error => {
        console.error('Error loading charts:', error);
        document.getElementById('loadingSpinner').innerHTML = 
            '<div class="alert alert-danger">Error loading analytics data. Please try again.</div>';
    });
</script>
{% endblock %}
